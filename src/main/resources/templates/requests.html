<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Frontdesk AI â€” Requests</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background:#f8f9fa; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
        .card { border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.05); }
        .badge-pending { background:#ffc107; }
        .badge-resolved { background:#198754; }
        .badge-unresolved { background:#dc3545; }
    </style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">ðŸ¤– Frontdesk AI</a>
        <div class="d-flex">
            <a class="nav-link text-white-50 me-3" href="/requests">Requests</a>
            <a class="nav-link text-white-50" href="/knowledge">Knowledge Base</a>
        </div>
    </div>
</nav>

<div class="container">
    <h3 class="mb-3">ðŸ“‹ Help Requests</h3>

    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div th:if="${#lists.isEmpty(requests)}" class="alert alert-info">
        No requests at the moment ðŸŽ‰
    </div>

    <div class="row" th:each="req : ${requests}">
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title" th:text="${req.customerQuestion}">Question text</h5>

                    <p class="mb-1"><strong>Caller:</strong> <span th:text="${req.customerId}">caller-web-guest</span></p>

                    <p class="mb-2">
                        Status:
                        <span class="badge"
                              th:classappend="${req.status}=='PENDING' ? ' badge-pending' :
                                  (${req.status}=='RESOLVED' ? ' badge-resolved' : ' badge-unresolved')"
                              th:text="${req.status}">PENDING</span>
                    </p>

                    <p class="text-muted mb-3" th:if="${req.supervisorAnswer != null}">
                        <strong>Answer:</strong> <span th:text="${req.supervisorAnswer}"></span>
                    </p>

                    <form th:if="${req.status == 'PENDING'}" th:action="@{/resolve}" method="post" class="d-flex">
                        <input type="hidden" name="id" th:value="${req.id}">
                        <input type="text" name="answer" class="form-control me-2" placeholder="Enter supervisor answer" required>
                        <button type="submit" class="btn btn-success">Resolve</button>
                    </form>
                </div>

                <div class="card-footer small text-muted">
          <span th:if="${req.createdAt != null}"
                th:text="'Created: ' + ${#temporals.format(req.createdAt, 'dd MMM yyyy HH:mm')}"></span>
                    <span th:if="${req.createdAt == null}">Created: â€”</span>
                    <span th:if="${req.resolvedAt != null}"
                          th:text="' â€¢ Resolved: ' + ${#temporals.format(req.resolvedAt, 'dd MMM yyyy HH:mm')}"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
